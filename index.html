<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–ü–æ–≥–æ–¥–∞ –≤ –º—ñ—Å—Ç–∞—Ö –£–∫—Ä–∞—ó–Ω–∏</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<h2 style="text-align: center;">–ü–æ–≥–æ–¥–∞ –≤ –º—ñ—Å—Ç–∞—Ö –£–∫—Ä–∞—ó–Ω–∏</h2>
<div class="controls">
    <div class="search-container">
        <input type="text" id="city-search" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞...">
        <button id="search-btn">–ü–æ—à—É–∫</button>
    </div>
    <div class="dropdown-container">
        <label for="city-select">–í–∏–±–µ—Ä—ñ—Ç—å –º—ñ—Å—Ç–æ:</label>
        <select id="city-select">
            <option value="">-- –û–±–µ—Ä—ñ—Ç—å –º—ñ—Å—Ç–æ --</option>
        </select>
    </div>
</div>
<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
    const API_KEY = '20b98749ee0e46330e9bf1cd905c5bf9';

    const cities = [
        { name: "–ö–∏—ó–≤", lat: 50.4501, lon: 30.5234 },
        { name: "–õ—å–≤—ñ–≤", lat: 49.8397, lon: 24.0297 },
        { name: "–•–∞—Ä–∫—ñ–≤", lat: 49.9935, lon: 36.2304 },
        { name: "–û–¥–µ—Å–∞", lat: 46.4825, lon: 30.7233 },
        { name: "–î–Ω—ñ–ø—Ä–æ", lat: 48.4647, lon: 35.0462 },
        { name: "–ó–∞–ø–æ—Ä—ñ–∂–∂—è", lat: 47.8388, lon: 35.1396 },
        { name: "–ß–µ—Ä–Ω—ñ–≤—Ü—ñ", lat: 48.2917, lon: 25.9354 },
        { name: "–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫", lat: 48.9226, lon: 24.7111 },
        { name: "–¢–µ—Ä–Ω–æ–ø—ñ–ª—å", lat: 49.5535, lon: 25.5948 },
        { name: "–£–∂–≥–æ—Ä–æ–¥", lat: 48.6208, lon: 22.2879 },
        { name: "–•–µ—Ä—Å–æ–Ω", lat: 46.6354, lon: 32.6169 },
        { name: "–ú–∏–∫–æ–ª–∞—ó–≤", lat: 46.9750, lon: 31.9946 },
        { name: "–°—É–º–∏", lat: 50.9077, lon: 34.7981 },
        { name: "–ü–æ–ª—Ç–∞–≤–∞", lat: 49.5883, lon: 34.5514 },
        { name: "–ß–µ—Ä–∫–∞—Å–∏", lat: 49.4444, lon: 32.0598 },
        { name: "–ß–µ—Ä–Ω—ñ–≥—ñ–≤", lat: 51.4982, lon: 31.2893 },
        { name: "–ö—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π", lat: 48.5106, lon: 32.2662 },
        { name: "–†—ñ–≤–Ω–µ", lat: 50.6199, lon: 26.2516 },
        { name: "–õ—É—Ü—å–∫", lat: 50.7476, lon: 25.3254 },
        { name: "–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∏–π", lat: 49.4229, lon: 26.9871 },
        { name: "–î–æ–Ω–µ—Ü—å–∫", lat: 48.0159, lon: 37.8028 },
        { name: "–õ—É–≥–∞–Ω—Å—å–∫", lat: 48.5740, lon: 39.3078 },
        { name: "–°—ñ–º—Ñ–µ—Ä–æ–ø–æ–ª—å", lat: 44.9521, lon: 34.1024 },
        { name: "–í—ñ–Ω–Ω–∏—Ü—è", lat: 49.2331, lon: 28.4682 },
        { name: "–ñ–∏—Ç–æ–º–∏—Ä", lat: 50.2547, lon: 28.6587 }
    ];

    const citySelect = document.getElementById('city-select');
    const map = L.map('map').setView([49.0, 31.0], 6);

    // –î–æ–¥–∞—î–º–æ —à–∞—Ä OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // –î–æ–¥–∞—î–º–æ –º—ñ—Å—Ç–∞ –¥–æ –≤–∏–ø–∞–¥–∞—é—á–æ–≥–æ —Å–ø–∏—Å–∫—É
    cities.forEach(city => {
        const option = document.createElement('option');
        option.value = `${city.lat},${city.lon}`;
        option.textContent = city.name;
        citySelect.appendChild(option);
    });

    // –î–æ–¥–∞—î–º–æ –º–∞—Ä–∫–µ—Ä–∏
    cities.forEach(city => {
        const marker = L.marker([city.lat, city.lon]).addTo(map);
        marker.bindPopup("–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ–≥–æ–¥–∏...");

        marker.on('click', async () => {
            const weather = await getWeather(city.lat, city.lon);
            if (weather) {
                marker.setPopupContent(`
                    <div class="info-box">
                        <strong>${city.name}</strong><br>
                        ${weather.weather[0].description}<br>
                        üå° –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${weather.main.temp}¬∞C<br>
                        üíß –í–æ–ª–æ–≥—ñ—Å—Ç—å: ${weather.main.humidity}%<br>
                        üå¨ –í—ñ—Ç–µ—Ä: ${weather.wind.speed} –º/—Å
                    </div>
                `);
            } else {
                marker.setPopupContent('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ –ø—Ä–æ –ø–æ–≥–æ–¥—É.');
            }
        });
    });

    // –û–±—Ä–æ–±–∫–∞ –≤–∏–±–æ—Ä—É –º—ñ—Å—Ç–∞
    citySelect.addEventListener('change', async () => {
        const value = citySelect.value;
        if (value) {
            const [lat, lon] = value.split(',').map(Number);
            map.setView([lat, lon], 10);
        }
    });

    // –ü–æ—à—É–∫ –ø–æ –Ω–∞–∑–≤—ñ –º—ñ—Å—Ç–∞
    document.getElementById('search-btn').addEventListener('click', () => {
        const searchValue = document.getElementById('city-search').value.toLowerCase();
        const city = cities.find(c => c.name.toLowerCase().includes(searchValue));
        if (city) {
            map.setView([city.lat, city.lon], 10);
        } else {
            alert("–ú—ñ—Å—Ç–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.");
        }
    });

    // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–≥–æ–¥–∏
    async function getWeather(lat, lon) {
        try {
            const response = await fetch(
                `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=ua`
            );
            const data = await response.json();
            return data.cod === 200 ? data : null;
        } catch (err) {
            console.error(err);
            return null;
        }
    }
</script>

</body>
</html>
